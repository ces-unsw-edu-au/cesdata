"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3765],{1270:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var t=s(5893),a=s(1151);const i={},o="Workflow on Katana @ UNSW",c={type:"mdx",permalink:"/cesdata/how-to-Katana",source:"@site/src/pages/how-to-Katana.md",title:"Workflow on Katana @ UNSW",description:"Please check Katana User\u2019s documentation.",frontMatter:{},unlisted:!1},r={},l=[{value:"Log-in / authentication",id:"log-in--authentication",level:2},{value:"Copying files",id:"copying-files",level:2},{value:"Version control with <code>git</code>",id:"version-control-with-git",level:2},{value:"Running interactive jobs with <code>pbs</code>",id:"running-interactive-jobs-with-pbs",level:2},{value:"Running batch jobs with <code>pbs</code>",id:"running-batch-jobs-with-pbs",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"workflow-on-katana--unsw",children:"Workflow on Katana @ UNSW"}),"\n",(0,t.jsxs)(n.p,{children:["Please check ",(0,t.jsx)(n.a,{href:"https://unsw-restech.github.io/index.html",children:"Katana User\u2019s documentation"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Here some useful tips:"}),"\n",(0,t.jsx)(n.h2,{id:"log-in--authentication",children:"Log-in / authentication"}),"\n",(0,t.jsxs)(n.p,{children:["To apply for an account in Katana you can send an email to the ",(0,t.jsx)(n.a,{href:"mailto:ITServiceCentre@unsw.edu.au",children:"UNSW IT Service Centre"})," giving your zID, your role within UNSW and the name of your supervisor or head of your research group."]}),"\n",(0,t.jsxs)(n.p,{children:["In Linux and MacOSX I set up my bash terminal to recognize my zID (as env variable ",(0,t.jsx)(n.code,{children:"$zID"}),") and set up ",(0,t.jsx)(n.a,{href:"https://www.ssh.com/ssh/public-key-authentication",children:"SSH Public key authentication"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"copying-files",children:"Copying files"}),"\n",(0,t.jsxs)(n.p,{children:["From Linux/MacOSX I use ",(0,t.jsx)(n.code,{children:"ssh"})," and ",(0,t.jsx)(n.code,{children:"scp"})," to copy some datasources using the ",(0,t.jsx)(n.em,{children:"katana data mover"})," (kdm) node:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"export OUTPUTDIR=...\nssh $zID@kdm.restech.unsw.edu.au mkdir -p /srv/scratch/cesdata/$OUTPUTDIR\n\nscp -r $WORKDIR/... $zID@kdm.restech.unsw.edu.au:/srv/scratch/cesdata/$OUTPUTDIR\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"version-control-with-git",children:["Version control with ",(0,t.jsx)(n.code,{children:"git"})]}),"\n",(0,t.jsxs)(n.p,{children:["Log into the katana node with ",(0,t.jsx)(n.code,{children:"ssh"})," and use ",(0,t.jsx)(n.code,{children:"git"})," to clone and update repositories:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"ssh $zID@katana.restech.unsw.edu.au\n## SSH Public key authentication for github\neval $(ssh-agent)\nssh-add\n\ngit clone ...\n\n## load bash environment variables\nsource $HOME/proyectos/.../env/project.env\ncd $SCRIPTDIR\ngit status\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"running-interactive-jobs-with-pbs",children:["Running interactive jobs with ",(0,t.jsx)(n.code,{children:"pbs"})]}),"\n",(0,t.jsxs)(n.p,{children:["It is always useful to run interactive ",(0,t.jsx)(n.code,{children:"pbs"})," jobs:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'ssh $zID@katana.restech.unsw.edu.au\nsource $HOME/proyectos/.../env/project.env\ncd $WORKDIR\n\nqsub -I -l select=1:ncpus=1:mem=120gb,walltime=12:00:00\n#" if we need a graphical session "\n##qsub -I -X -l select=1:ncpus=1:mem=32gb,walltime=4:00:00\n\n'})}),"\n",(0,t.jsx)(n.p,{children:"Some recomendations from Duncan:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use skylake-avx512 by making your interactive job request become something like: ",(0,t.jsx)(n.code,{children:"qsub -I -l select=1:ncpus=1:cpuflags=skylake-avx512:mem=120gb -l walltime=12:00:00"}),". This will take a little longer to start but will mean running on newer hardware."]}),"\n",(0,t.jsx)(n.li,{children:"Walltime should be 12:00:00 unless you need more. i.e. nothing shorter."}),"\n",(0,t.jsx)(n.li,{children:"When requesting memory you the point at which you have less options is 124gb, 180gb, 248gb, 370gb, 750gb and 1000gb. i.e. requesting 126gb is not a great idea."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"These are the cpuflags:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'cputype       : "sandybridge", "ivybridge", "broadwell", "haswell", "skylake-avx512"\ncpuflags      : "avx", "avx2", "avx512bw", "avx512cd", "avx512dq", "avx512f", "avx512vl", "avx512vnni", "avx512_vnni"\n'})}),"\n",(0,t.jsxs)(n.h2,{id:"running-batch-jobs-with-pbs",children:["Running batch jobs with ",(0,t.jsx)(n.code,{children:"pbs"})]}),"\n",(0,t.jsx)(n.p,{children:"Now run the batch scripts for Growing degree days (GDD) based on NARCLiM data for all models and scenarios:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"ssh $zID@katana.restech.unsw.edu.au\nsource $HOME/proyectos/.../env/project-env.sh\nsource $HOME/proyectos/.../env/katana-env.sh\n\ncd $WORKDIR\n\nqsub -l select=1:ncpus=1:mem=32gb,walltime=4:00:00 -J 1-2 $SCRIPTDIR/bin/pbs/....pbs\n\nqsub -l select=1:ncpus=2:mem=16gb,walltime=4:00:00 -J 3-4 $SCRIPTDIR/bin/pbs/....pbs\n\nqsub -J 5-36 $SCRIPTDIR/bin/pbs/....pbs\nqstat -tu $(whoami)\n# or \nqstat -tu $USER\n\n"})})]})}function d(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>o});var t=s(7294);const a={},i=t.createContext(a);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);